{%- macro javaClass(schemaName, schema, properties, indentLevel, isStatic) %}
{%- set modelClass = {schema: schema, schemaName: schemaName} | getModelClass %}
{%- set schemaForRef = schemaName | getAnonymousSchemaForRef %}
{% if schemaForRef %}
	{% set schema = schemaForRef %}
	{% set properties = schemaForRef.properties() %}
{% endif %}
{%- if modelClass %}
{%- set className = modelClass.getClassName() %}
{{ 'javaClass' | logJavaClass -}}
{{ className | logJavaClass -}}
{% set indent1 = indentLevel | indent1 -%}
{% set indent2 = indentLevel | indent2 -%}
{% set indent3 = indentLevel | indent3 -%}
{{ indent1 }}@JsonInclude(JsonInclude.Include.NON_NULL)
{{ indent1 }}public {% if isStatic %}static {% endif %}class {{ className }}
{%- if modelClass.isSubClass() %} extends {{ modelClass.getSuperClassName() }}{% endif %} {
{# Default constructor #}
{{ indent2 }}public {{ className }} () {
{{ indent2 }}}

{# If the top level object is an array, we need to deal with that specially. -#}
{%- if schema and schema.type() === 'array' -%}
{{ javaClass(type, null, schema.items().properties(), indentLevel+1, true) }}
{%- else -%} {# not an array at the top level. #}
{%- set first = true -%}
{#- Constructor with all properties -#}
{%- set hasNoProperties = properties | isEmpty -%}
{%- if not hasNoProperties -%}
{{ indent2 }}public {{ className }} (
{%- for name, prop in properties -%}
{%- set propModelClass = {schema: prop, schemaName: name} | getModelClass %}
{%- set realClassName = propModelClass.getClassName() %}
{%- set variableName = realClassName | identifierName %}
{%- set typeInfo = [name, realClassName, prop] | fixType %}
{%- set type = typeInfo[0] -%}
{%- if first -%}
{%- set first = false -%}
{%- else -%}
, {% endif %}
{{ indent3 }}{{ type }} {{ variableName }}
{%- endfor -%}
) {
{% for name, prop in properties -%}
{%- set propModelClass = {schema: prop, schemaName: name} | getModelClass %}
{%- set realClassName = propModelClass.getClassName() %}
{%- set variableName = realClassName | identifierName -%}
{{ indent3 }}this.{{ variableName }} = {{ variableName }};
{% endfor -%}
{{ indent2 }}}
{% endif -%}
{% endif -%}

{# Members #}
{%- for name, prop in properties %}
{%- set propModelClass = {schema: prop, schemaName: name} | getModelClass %}
{%- set realClassName = propModelClass.getClassName() %}
{%- set variableName = realClassName | identifierName -%}
{%- set typeInfo = [realClassName, realClassName, prop] | fixType -%}
{%- set type = typeInfo[0] %}
{% if variableName !== name -%}
{{ indent2 }}@JsonProperty("{{name}}")
{% endif -%}
{{ indent2 }}private {{ type }} {{ variableName }};
{%- endfor %}

{#- Getters and Setters #}
{%- for name, prop in properties %}
{#- TODO: This writes in the object names based on property name but the property name isn't always right because it might just be a ref - translate that into a real class name by ... getting the model class? yeah we can do that. pass in a null schema. -#}
{%- set propModelClass = {schema: prop, schemaName: name} | getModelClass %}
{%- set realClassName = propModelClass.getClassName() %}
{%- set variableName = realClassName | identifierName -%}
{%- set typeInfo = [name, realClassName, prop] | fixType -%}
{% set type = typeInfo[0] -%}
{% set isArrayOfObjects = typeInfo[1] %}
{{ indent2 }}public {{ type }} get{{- realClassName }}() {
{{ indent3 }}return {{ variableName }};
{{ indent2 }}}

{{ indent2 }}public {{ className }} set{{- realClassName }}({{ type }} {{ variableName }}) {
{{ indent3 }}this.{{-variableName }} = {{ variableName }};
{{ indent3 }}return this;
{{ indent2 }}}
{# Inner classes #}
{%- set innerModelClass = {schema: prop, schemaName: variableName} | getModelClass %}
{%- if prop.type() === 'object' and innerModelClass and innerModelClass.canBeInnerClass() %}
{{ javaClass(variableName, prop, prop.properties(), indentLevel+1, true) }}
{%- endif %}
{%- if isArrayOfObjects and innerModelClass and innerModelClass.canBeInnerClass() %}
{{ javaClass(variableName, prop, prop.items().properties(), indentLevel+1, true) }}
{%- endif %}
{# Enums #}
{%- if prop.enum() %}
{{ indent2 }}public static enum {{ type }} { {{ prop.enum() }} }
{%- endif %}
{%- endfor -%}

{{ indent2 }}public String toString() {
{{ indent3 }}return "{{ className }} ["
{%- for name, prop in properties %}
{%- set propModelClass = {schema: prop, schemaName: name} | getModelClass %}
{%- set realClassName = propModelClass.getClassName() %}
{%- set variableName = realClassName | identifierName %}
{{ indent3 }}+ " {{ variableName }}: " + {{ variableName }}
{%- endfor %}
{%- if modelClass.isSubClass() %}
{{ indent3 }}+ " super: " + super.toString(){% endif %}
{{ indent3 }}+ " ]";
{{ indent2 }}}
{{ indent1 }}}{% endif -%}
{%- endmacro -%}